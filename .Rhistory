set.seed(x)
xdim = sample(c(50:2000), 1)
ydim = sample(c(50:2000))
explicit = sample(c(TRUE,FALSE), 1)
ppl_n = sample(c(50:2000), 1)
ppl_loc = sample(list(cbind(sample(xdim,ppl_n, replace = T),sample(ydim,ppl_n, replace = T)), NULL), 1)[[1]]
ppl_scaling = sample(c(1:1000)/1000, 1)
budget = sample(c(200:5000), 1)
p_n = sample(c(1:1000), 1)
np_n = sample(c(1:1000), 1)
p_loc = sample(list(cbind(sample(xdim,p_n, replace = T),sample(ydim,p_n, replace = T)), NULL), 1)[[]]
np_loc = sample(list(cbind(sample(xdim,np_n, replace = T),sample(ydim,np_n, replace = T)), NULL),1)[[]]
mean_age = sample(c(10:150), 1)
sd_age = sample(c(1:50), 1)
travel_cost = sample(c(0:100), 1)
management_cost = sample(c(0:1000), 1)
value = sample(c(100:10000), 1)
mobility = sample(c(1:1000)/1)
k = sample(c(50:100)/100, 1)
ppl_scaling = sample(c(1:500)/1000, 1)
maturity = sample(c(0:round(mean_age/1.5, digits = 0)), 1)
max_age = sample(c(round(mean_age * 1.5, digits = 0):mean_age + sd_age * 3),1)
years = sample(c(0:10), 1)
if(explicit == FALSE) {
people <- make_people(
xdim = xdim,
ydim = ydim,
ppl_n = ppl_n); # makes the people
} else {
people <- get_people(
ppl_loc = ppl_loc, # or gets the people
ppl_scaling = ppl_scaling)
}
library(devtools)
install_github("chirslittleboy/deforecasteR")
install_github("chirslittleboy/deforecasteR")
install_github("chirslittleboy/deforecasteR")
install_github("chirslittleboy/deforecasteR")
install_github("chrislittleboy/deforecasteR")
library(deforecasteR)
deforecast
deforecast()
deforecasteR::deforecast()
deforecasteR
install_github("chrislittleboy/deforecasteR")
library(deforecasteR)
loadNamespace(deforecasteR)
loadNamespace(deforecast)
library(deforecasteR)
?install_github
install_github("chrislittleboy/deforecasteR")
install_github("chrislittleboy/deforecasteR", force = T)
library(devtools)
install.github("chrislittleboy/deforecasteR")
install_github("chrislittleboy/deforecasteR")
install_github("chrislittleboy/deforecasteR", force = T)
library(deforecasteR)
roxygenise()
library(roxygen2)
roxygen2::roxygenise()
roxygenise()
roxygenise()
unload()
library(devtools)
install_github("chrislittleboy/deforecasteR")
library(deforecasteR)
library(raster)
library(rts)
library(dplyr)
setwd("/home/chris/Documents/data/landsat/tehri/")
ndvis <- list.files("./ndvi")
ls_todate <- function(x){as.Date(substr(x[1], 23,30), "%Y%m%d")}
ndvi_dat_df <- data.frame(unlist(ndvis))
colnames(ndvi_dat_df) <- "date"
ndvi_dat_df <- ndvi_dat_df %>% mutate(date = as.POSIXct(as.Date(substr(date, 23,30), "%Y%m%d")))
dat <- ndvi_dat_df$date
ndvi_dates <- lapply(ndvis, ls_todate)
dat <- data.frame(sapply(ndvi_dates, function(x) x[1:max(lengths(ndvi_dates))]))
colnames(dat) <- "date"
ndvi <- brick()
x <- ndvis[1]
substr(x[1], 23,30)
ndvis <- list.files("./ndvi", full.names = T)
tehricrop <- function(x){crop(raster(x), extent(c(210000,310000,3330000,3400000)), snap = "out")}
ndvi_tehri <- stack(lapply(ndvis, tehricrop))
tehricrop <- function(x){crop(raster(x), extent(c(210000,310000,3330000,3400000)), snap = "out")}
tehricrop <- function(x){crop(raster(x), extent(c(210000,350000,3330000,3400000)), snap = "out")}
ndvis <- list.files("./ndvi", full.names = T)
ndvi_tehri <- lapply(ndvis, tehricrop)
rts_tehri <- rts(x = ndvi_tehri,time = dat)
rts_tehri <- rts(x = stack(ndvi_tehri),time = dat)
tehricrop <- function(x){crop(raster(x), extent(c(210000,310000,3330000,3400000)), snap = "out")}
rm(list = ndvi_tehri())
rm(list = "ndvi_tehri")
ndvis <- lapply(tehricrop)
ndvis <- list.files("./ndvi", full.names = T)
tehricrop <- function(x){crop(raster(x), extent(c(210000,310000,3330000,3400000)), snap = "out")}
crs(raster(ndvis[[1]]))
extent(raster(ndvis[[1]]))
plot(raster(ndvis[[1]]))
ndvi_tehri <- stack(lapply(ndvis, tehricrop))
install_github("chrislittleboy/deforecasteR")
library(devtools)
library(sf)
getwd()
setwd("/home/chris/Documents/data")
list.files()
list.files("./dams/")
list.files("./dams/GRanD_Version_1_3")
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_Version_1_3.shp")
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_Version_v1_3.shp")
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp")
colnames(dams)
library(tidyverse)
head(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M)
head(dams)
summary(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
filter(YEAR >= 1986)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na()
?quantile
apply_cut <-function(x) {
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.1))),include.lowest=TRUE)
}
apply_cut(dams$CAP_MCM)
?cut
apply_cut <-function(x) {
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.1))),include.lowest=TRUE, labels = F)
}
apply_cut(dams$CAP_MCM)
apply_cut <-function(x) {
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.1))),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>% mutate(
cap_top = apply_cut(CAP_MCM),
area_top = apply_cut(AREA_SKM),
height_top = apply_cut(DAM_HGT_M),
dis_top = apply_cut(DIS_AVG_LS)
) %>%
mutate(score = cap_top + area_top + height_top = dis_top)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>% mutate(
cap_top = apply_cut(CAP_MCM),
area_top = apply_cut(AREA_SKM),
height_top = apply_cut(DAM_HGT_M),
dis_top = apply_cut(DIS_AVG_LS)
) %>%
mutate(score = cap_top + area_top + height_top + dis_top)
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>% mutate(
cap_top = apply_cut(CAP_MCM),
area_top = apply_cut(AREA_SKM),
height_top = apply_cut(DAM_HGT_M),
dis_top = apply_cut(DIS_AVG_LS)
) %>%
mutate(score = cap_top + area_top + height_top + dis_top) %>%
st_drop_geometry()
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>% mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1 ,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>% mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1 ,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
apply_cut <-function(x) {
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2))),include.lowest=TRUE, labels = F)
}
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
DAM_HEIGHT_M = ifelse(ALT_HGT_M >= DAM_HGT_M, ALT_HGT_M,DAM_HGT_M),
AREA_SQM = ifelse(AREA_SKM <= AREA_POLY, AREA_POLY, AREA_SKM)
)
View(dams)
summary(dams)
summary(dams$DAM_HGT_M)
length(is.na(dams$DAM_HGT_M))
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
DAM_HGT_M = ifelse(ALT_HGT_M >= DAM_HGT_M, ALT_HGT_M,DAM_HGT_M),
AREA_SQM = ifelse(AREA_SKM <= AREA_POLY, AREA_POLY, AREA_SKM)
)
length(is.na(dams$DAM_HGT_M))
View(dams)
is.na(dams$DAM_HGT_M)
length(is.na(dams$DAM_HGT_M) == T)
length(is.na(dams$DAM_HGT_M) == TRUE)
length(is.na(dams$DAM_HGT_M == TRUE))
table(is.na(dams$DAM_HGT_M))
table(dams$DAM_HGT_M == -99))
table(dams$DAM_HGT_M == -99)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
DAM_HGT_M = ifelse(ALT_HGT_M >= DAM_HGT_M, ALT_HGT_M,DAM_HGT_M),
AREA_SQM = ifelse(AREA_SKM <= AREA_POLY, AREA_POLY, AREA_SKM)
)
table(dams$DAM_HGT_M == -99)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
table(dams$DAM_HGT_M == -99)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na()
table(dams$DAM_HGT_M == -99)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na()
dams[dams <0] <- NA
dams[][dams <= 0] <- NA
dams[<= 0] <- NA
dams[dams[] <= 0]] <- NA
apply_cut <-function(x) {
x[x<0,] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2))),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na()
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2))),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2))),include.lowest=TRUE, labels = F, na.rm = T)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2, na.rm = T))),include.lowest=TRUE, labels = F, na.rm = T)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
?quantile
?cut
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2, na.rm = T))),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2, na.rm = TRUE))),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2), na.rm = TRUE)),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, ALT_HGT_M, AREA_POLY, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1986) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1970) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2), na.rm = TRUE)),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1970) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 1,
area_top = apply_cut(AREA_SKM) - 1,
height_top = apply_cut(DAM_HGT_M) -1,
dis_top = apply_cut(DIS_AVG_LS) - 1
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry()
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1970) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 5,
area_top = apply_cut(AREA_SKM) - 5,
height_top = apply_cut(DAM_HGT_M) -5,
dis_top = apply_cut(DIS_AVG_LS) - 5
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry()
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2), na.rm = TRUE)),include.lowest=TRUE, labels = F)
}
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1990) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 5,
area_top = apply_cut(AREA_SKM) - 5,
height_top = apply_cut(DAM_HGT_M) -5,
dis_top = apply_cut(DIS_AVG_LS) - 5
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry()
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1990) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 5,
area_top = apply_cut(AREA_SKM) - 5,
height_top = apply_cut(DAM_HGT_M) -5,
dis_top = apply_cut(DIS_AVG_LS) - 5
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.1), na.rm = TRUE)),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1990) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 5,
area_top = apply_cut(AREA_SKM) - 5,
height_top = apply_cut(DAM_HGT_M) -5,
dis_top = apply_cut(DIS_AVG_LS) - 5
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
apply_cut <-function(x) {
x[x<0] <- NA
cut(x, breaks =c(quantile(x,probs=seq(0,1, by=0.2), na.rm = TRUE)),include.lowest=TRUE, labels = F)
}
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1990) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 5,
area_top = apply_cut(AREA_SKM) - 5,
height_top = apply_cut(DAM_HGT_M) -5,
dis_top = apply_cut(DIS_AVG_LS) - 5
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
dams[dams < 0] <- NA
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1990) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 5,
area_top = apply_cut(AREA_SKM) - 5,
height_top = apply_cut(DAM_HGT_M) -5,
dis_top = apply_cut(DIS_AVG_LS) - 5
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
st_drop_geometry() %>%
filter(score == 0)
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>% select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1990) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 5,
area_top = apply_cut(AREA_SKM) - 5,
height_top = apply_cut(DAM_HGT_M) -5,
dis_top = apply_cut(DIS_AVG_LS) - 5
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
filter(score == 0)
View(dams)
dams <- read_sf("./dams/GRanD_Version_1_3/GRanD_dams_v1_3.shp") %>%
select(GRAND_ID, DAM_NAME,COUNTRY, YEAR, ALT_YEAR,CAP_MCM, AREA_SKM, DAM_HGT_M, DIS_AVG_LS) %>%
mutate(YEAR = ifelse(YEAR < ALT_YEAR, ALT_YEAR, YEAR)) %>%
filter(YEAR >= 1990) %>% drop_na() %>%
mutate(
cap_top = apply_cut(CAP_MCM) - 5,
area_top = apply_cut(AREA_SKM) - 5,
height_top = apply_cut(DAM_HGT_M) -5,
dis_top = apply_cut(DIS_AVG_LS) - 5
) %>%
mutate(score = cap_top * area_top * height_top * dis_top) %>%
filter(score == 0)
View(dams)
View(dams)
